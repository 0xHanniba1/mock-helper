# Mock Helper 使用文档

> 轻量级 API Mock 助手 - Chrome 扩展插件
> 
> 当前版本：**v1.1.0**

## 📋 功能概述

Mock Helper 是一款浏览器插件，可以在**不修改代码**的情况下拦截前端 API 请求，返回自定义的 Mock 数据。

### 核心功能

| 功能 | 说明 |
|------|------|
| 🎯 请求拦截 | 同时支持 `fetch` 和 `XMLHttpRequest` |
| 🔗 URL 匹配 | 支持精确匹配和通配符 `*` |
| ⏱️ 延迟模拟 | 自定义响应延迟，模拟慢网络 |
| 📊 状态码 | 自定义 HTTP 状态码（200、404、500 等）|
| 🔄 实时生效 | 保存规则后立即生效，无需刷新页面 |
| 🎛️ 全局开关 | 一键启用/禁用所有 Mock（绿色=ON，灰色=OFF）|
| 🖱️ 右键快捷添加 | 选中 URL 文本右键快速添加规则 |

### 适用场景

- 前端开发时后端接口未就绪
- 测试边界条件（错误码、空数据、超时等）
- 复现线上 bug（模拟特定响应）
- 接口联调时快速切换数据

---

## 📦 安装方法

### 加载已解压的扩展（开发者模式）

1. 下载并解压 `mock-helper.zip`
2. 打开 Chrome，地址栏输入 `chrome://extensions/`
3. 打开右上角「**开发者模式**」开关
4. 点击「**加载已解压的扩展程序**」
5. 选择解压后的 `mock-helper` 文件夹
6. 安装成功后，工具栏会出现 🎭 图标

### 插件更新

1. 下载新版本并解压覆盖原文件夹
2. 在 `chrome://extensions/` 页面点击 Mock Helper 的 **刷新按钮** 🔄
3. 刷新已打开的网页

---

## 🚀 快速开始

### 方式一：手动添加规则

1. 点击浏览器工具栏的 **🎭 Mock Helper** 图标
2. 点击「**+ 添加 Mock 规则**」按钮
3. 填写规则配置：

| 字段 | 说明 | 示例 |
|------|------|------|
| URL 规则 | 要拦截的请求路径 | `/api/user/info` |
| 状态码 | HTTP 响应状态码 | `200` |
| 延迟 (ms) | 响应延迟时间 | `500` |
| 响应内容 | JSON 格式的响应数据 | `{"code": 0, "data": {}}` |

4. 点击「**保存**」

### 方式二：右键快捷添加（推荐）

1. 在页面或控制台中**选中 URL 文本**（如 `/api/user/info`）
2. 右键点击，选择「**Mock 此接口: "/api/user/info"**」
3. 点击浏览器工具栏的 Mock Helper 图标
4. 编辑弹窗会自动打开并预填充 URL
5. 填写响应内容后保存

### 验证 Mock 生效

打开任意网站，按 `F12` 打开控制台，测试请求：

```javascript
fetch('/api/user/info').then(r => r.json()).then(console.log)
```

如果返回你设置的 Mock 数据，说明配置成功 ✅

---

## 📖 详细功能说明

### 1. URL 匹配规则

#### 精确匹配

```
/api/user/info          → 只匹配 /api/user/info
/api/order/123          → 只匹配 /api/order/123
```

#### 通配符匹配

```
/api/user/*             → 匹配 /api/user/info, /api/user/profile 等
/api/*/detail           → 匹配 /api/order/detail, /api/product/detail 等
/api/*                  → 匹配所有 /api/ 开头的请求
```

### 2. 响应状态码

| 状态码 | 含义 | 使用场景 |
|--------|------|----------|
| `200` | 成功 | 正常响应 |
| `400` | 请求错误 | 参数校验失败 |
| `401` | 未授权 | 测试登录过期 |
| `404` | 未找到 | 测试资源不存在 |
| `500` | 服务器错误 | 测试异常处理 |

### 3. 全局开关状态

| 状态 | 颜色 | 文字 |
|------|------|------|
| 启用 | 🟢 绿色 | ON |
| 禁用 | ⚫ 灰色 | OFF |

### 4. 右键菜单

| 菜单项 | 触发方式 | 说明 |
|--------|----------|------|
| Mock 此接口: "xxx" | 选中文本后右键 | 将选中的文本作为 URL 规则 |
| Mock 此链接 | 在链接上右键 | 提取链接的路径作为 URL 规则 |

---

## 🔧 调试 API

```javascript
window.__mockHelper.getRules()     // 查看当前所有规则
window.__mockHelper.isEnabled()    // 查看是否启用
window.__mockHelper.reload()       // 重新加载规则
```

---

## ❓ 常见问题

### Q1: 规则添加后不生效？

1. 确认全局开关已开启（显示绿色 ON）
2. 刷新目标网页
3. 控制台执行 `window.__mockHelper.reload()`

### Q2: 本地 HTML 文件无法使用？

使用本地服务器：
```bash
python3 -m http.server 8080
```
访问 `http://localhost:8080/your-file.html`

---

## 📝 更新日志

### v1.1.0 (2026-01-02)

**新功能**

- ✨ 右键菜单支持选中文本快速添加规则
- ✨ 右键菜单支持链接快速添加规则
- ✨ 全局开关增加 ON/OFF 文字标识

**优化**
- 🎨 改进开关样式（绿色=启用，灰色=禁用）
- 🔄 页面加载时自动同步规则

**修复**
- 🐛 修复编辑/删除按钮点击无效（CSP 策略限制）
- 🐛 修复规则不同步到页面的问题
- 🐛 修复相对路径 URL 匹配失败的问题

### v1.0.0 (2026-01-02)

**初始版本**
- ✅ 基础 Mock 功能
- ✅ fetch / XHR 双重拦截
- ✅ URL 通配符匹配
- ✅ 延迟和状态码设置
- ✅ 弹窗管理界面
- ✅ 全局开关
